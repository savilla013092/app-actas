rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ══════════════════════════════════════════════════════════════
    // REGLAS TEMPORALES PARA IMPORTACIÓN
    // ══════════════════════════════════════════════════════════════

    // IMPORTANTE: Estas reglas son temporales para permitir la importación
    // Después de importar, restaurar firestore.rules.backup

    function estaAutenticado() {
      return request.auth != null;
    }

    // ══════════════════════════════════════════════════════════════
    // COLECCIÓN: USUARIOS - Permitir escritura para auto-registro
    // ══════════════════════════════════════════════════════════════

    match /usuarios/{userId} {
      allow read: if estaAutenticado();
      allow create, update: if estaAutenticado();
      allow delete: if false;
    }

    // ══════════════════════════════════════════════════════════════
    // COLECCIÓN: ACTIVOS - Permitir escritura para importación
    // ══════════════════════════════════════════════════════════════

    match /activos/{activoId} {
      allow read: if estaAutenticado();
      allow create, update: if estaAutenticado();
      allow delete: if false;
    }

    // ══════════════════════════════════════════════════════════════
    // COLECCIÓN: REVISIONES
    // ══════════════════════════════════════════════════════════════

    match /revisiones/{revisionId} {
      allow read: if estaAutenticado();
      allow create, update: if estaAutenticado();
      allow delete: if false;
    }

    // ══════════════════════════════════════════════════════════════
    // COLECCIÓN: CONSECUTIVOS (solo Cloud Functions)
    // ══════════════════════════════════════════════════════════════

    match /consecutivos/{docId} {
      allow read, write: if false;
    }

    // ══════════════════════════════════════════════════════════════
    // COLECCIÓN: AUDITORÍA
    // ══════════════════════════════════════════════════════════════

    match /auditoria/{logId} {
      allow read: if estaAutenticado();
      allow write: if false;
    }
  }
}
